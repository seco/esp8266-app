<html><head><link rel="import" href="../polymer/polymer.html"><script>Polymer({is:'platinum-sw-register',_version:'1.0',properties:{autoRegister:{type:Boolean,value:!1},baseUri:{type:String,value:document._currentScript?document._currentScript.baseURI:HTMLImports.importForElement?HTMLImports.importForElement(document.currentScript).baseURI:document.currentScript?document.currentScript.baseURI:'./'},clientsClaim:{type:Boolean,value:!1},href:{type:String,value:'sw-import.js'},reloadOnInstall:{type:Boolean,value:!1},scope:{type:String,value:null},skipWaiting:{type:Boolean,value:!1},state:{notify:!0,readOnly:!0,type:String},__platinumSwRegistrees:{type:Array,value:function(){return[]}}},listeners:{'platinum-sw-register':'_onPlatinumSwRegister','platinum-sw-unregister':'_onPlatinumSwUnregister'},register:function(){'serviceWorker'in navigator?this._constructServiceWorkerUrl().then(function(a){this._registerServiceWorker(a)}.bind(this)):(this._setState('unsupported'),this.fire('service-worker-error','Service workers are not available in the current browser.'))},_constructServiceWorkerUrl:function(){for(var d,a=[],b=new URL(this.baseUri,window.location.href),c=0;c<this.__platinumSwRegistrees.length;c++)d=this.__platinumSwRegistrees[c],a.push(d._getParameters(b));return Promise.all(a).then(function(f){var g={baseURI:b,version:this._version};return f.forEach(function(h){Object.keys(h).forEach(function(j){g[j]=Array.isArray(g[j])?g[j].concat(h[j]):[].concat(h[j])})}),g}.bind(this)).then(function(f){f.importscriptLate&&(f.importscript?f.importscript=f.importscript.concat(f.importscriptLate):f.importscript=f.importscriptLate),f.importscript&&(f.importscript=this._unique(f.importscript)),delete f.importscriptLate,f.clientsClaim=this.clientsClaim,f.skipWaiting=this.skipWaiting;var g=new URL(this.href,window.location);return g.search=this._serializeUrlParams(f),g}.bind(this))},_unique:function(a){return a.filter(function(b,c){return a.indexOf(b)===c})},_serializeUrlParams:function(a){return Object.keys(a).sort().map(function(b){return encodeURIComponent(b)+'='+encodeURIComponent(a[b])}).join('&')},_registerServiceWorker:function(a){var b=this.scope?{scope:this.scope}:null;navigator.serviceWorker.register(a,b).then(function(c){c.active&&this._setState('installed'),c.onupdatefound=function(){var d=c.installing;d.onstatechange=function(){switch(d.state){case'installed':navigator.serviceWorker.controller?(this._setState('updated'),this.fire('service-worker-updated','A new service worker was installed, replacing the old service worker.')):this.reloadOnInstall?window.location.reload():(this._setState('installed'),this.fire('service-worker-installed','A new service worker was installed.'));break;case'redundant':this._setState('error'),this.fire('service-worker-error','The installing service worker became redundant.');}}.bind(this)}.bind(this)}.bind(this)).catch(function(c){if(this._setState('error'),this.fire('service-worker-error',c.toString()),'NetworkError'===c.name){var d=a.origin+a.pathname;Polymer.Base._error('A valid service worker script was not found at '+d+'\nTo learn how to fix this, please see\nhttps://github.com/PolymerElements/platinum-sw#top-level-sw-importjs')}}.bind(this))},attached:function(){this._onPlatinumSwRegister()},_onPlatinumSwUnregister:function(a){a.stopPropagation();var b=this.__getEventTarget(a),c=this.__platinumSwRegistrees.indexOf(b);-1!=c&&this.splice('__platinumSwRegistrees',c,1)},_onPlatinumSwRegister:function(a){if(a){a.stopPropagation();var b=this.__getEventTarget(a);this.push('__platinumSwRegistrees',b)}var c=Polymer.dom(this).children;this.autoRegister&&c.length==this.__platinumSwRegistrees.length&&this.async(this.register)},__getEventTarget:function(a){return a.composedPath?a.composedPath()[0]:Polymer.dom(a).rootTarget}});</script></head><body></body></html>